(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{m:()=>x});var t=document.querySelector(".popup_type_name"),n=document.querySelector(".popup_type_full-view"),o=document.querySelector(".popup_type_image"),r=document.querySelector(".popup_type_avatar"),a=t.querySelector(".popup__form"),c=o.querySelector(".popup__form"),i=r.querySelector(".popup__form"),u=t.querySelector(".popup__field-to-fill_name"),l=t.querySelector(".popup__field-to-fill_description"),s=r.querySelector(".popup__field-to-fill_avatar"),d=document.querySelector(".profile__name-button"),p=document.querySelector(".profile__avatar-outer"),f=document.querySelector(".profile__add-button"),_=document.querySelector(".profile__name-text"),v=document.querySelector(".profile__description"),m=document.querySelector("#card-template").content,h=document.querySelector(".cards"),y=document.querySelectorAll(".popup"),S=o.querySelector(".popup__field-to-fill_name"),b=o.querySelector(".popup__field-to-fill_src"),q=document.querySelector(".profile__avatar"),C={baseUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"772b4c0c-f5f0-4e66-b190-76ebea65e716"}},L=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function E(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function g(e){"Escape"===e.key&&E(document.querySelector(".popup_opened"))}var x,A,U=function(e){return e.some((function(e){return e._id==x}))};function T(e,t,o,r,a){var c=m.cloneNode(!0),i=c.querySelector(".card__image"),u=n.querySelector(".popup__img"),l=c.querySelector(".card__like-digit"),s=c.querySelector(".card__like-button");i.src=e,c.querySelector(".card__title").textContent=t,i.alt=t,l.textContent=a.length,U(a)&&s.classList.add("card__like-button_active");var d=a;c.querySelector(".card__like-button").addEventListener("click",(function(){U(d)?function(e){return fetch("".concat(C.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:C.headers}).then(L)}(r).then((function(e){l.textContent=e.likes.length,s.classList.remove("card__like-button_active"),d=e.likes})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(C.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:C.headers}).then(L)}(r).then((function(e){l.textContent=e.likes.length,s.classList.add("card__like-button_active"),d=e.likes})).catch((function(e){return console.log(e)}))}));var p=c.querySelector(".card__delete-button");return o===x&&(p.classList.add("card__delete-button_active"),p.addEventListener("click",(function(e){(function(e){return fetch("".concat(C.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:C.headers}).then(L)})(r).then((function(){return e.target.parentNode.remove()}))}))),c.querySelector(".card__image").addEventListener("click",(function(){u.alt=t,u.src=e,n.querySelector(".popup__img-text").textContent=t,k(n)})),c}function P(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}Promise.all([fetch(C.baseUrl+"/users/me",{headers:C.headers}).then(L),fetch(C.baseUrl+"/cards",{headers:C.headers}).then(L)]).then((function(e){_.textContent=e[0].name,v.textContent=e[0].about,q.src=e[0].avatar,x=e[0]._id,(e=e[1].reverse()).forEach((function(e){var t=T(e.link,e.name,e.owner._id,e._id,e.likes);h.prepend(t)}))})).catch((function(e){return console.log(e)})),A={formSelector:".popup__form",inputSelector:".popup__field-to-fill",buttonSelector:".popup__button",inputInvalidClass:"popup__field-to-fill_invalid",errorActiveClass:"popup__error-message_active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.buttonSelector);P(n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputInvalidClass),o.classList.remove(n.errorActiveClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputInvalidClass),r.textContent=n,r.classList.add(o.errorActiveClass)}(e,t,t.validationMessage,n)}(e,r,t),P(n,o)}))}))}(e,A)})),f.addEventListener("click",(function(){k(o)})),d.addEventListener("click",(function(){var e;e=t,u.value=_.textContent,l.value=v.textContent,k(e)})),p.addEventListener("click",(function(){k(r)})),a.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=t.querySelector(".popup__button");r.textContent="Сохранение...",(n=u.value,o=l.value,fetch(C.baseUrl+"/users/me",{method:"PATCH",headers:{authorization:C.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then(L)).then((function(e){_.textContent=e.name,v.textContent=e.about,r.disabled=!0,E(t)})).catch((function(e){return console.log(e)})).finally((function(){r.textContent="Сохранить"}))})),c.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=o.querySelector(".popup__button");r.textContent="Сохранение...",r.disabled=!0,(t=S.value,n=b.value,fetch(C.baseUrl+"/cards",{method:"POST",headers:{authorization:C.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then(L)).then((function(e){h.prepend(T(e.link,e.name,e.owner._id,e._id,e.likes)),E(o),S.value="",b.value=""})).catch((function(e){return console.log(e)})).finally((function(){r.textContent="Создать"}))})),i.addEventListener("submit",(function(e){e.preventDefault();var t,n=r.querySelector(".popup__button");n.textContent="Сохранение...",n.disabled=!0,(t=s.value,fetch(C.baseUrl+"/users/me/avatar ",{method:"PATCH",headers:{authorization:C.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(L)).then((function(e){q.src=e.avatar,E(r),s.value=""})).catch((function(e){return console.log(e)})).finally((function(){n.textContent="Сохранить"}))})),y.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&E(e),t.target.classList.contains("popup__close-button")&&E(e)}))}))})();